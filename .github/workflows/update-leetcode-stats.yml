name: Update LeetCode Stats

on:
  schedule:
    # Runs daily at 00:00 UTC
    - cron: "0 0 * * *"
  workflow_dispatch: # Allows manual triggering
  push:
    branches:
      - main
    paths-ignore:
      - "assets/images/*.svg"
      - "output/*.svg"

jobs:
  update-leetcode-stats:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate LeetCode Stats
        uses: KnlnKS/leetcode-stats-card@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          username: xlreon
          theme: dark
          hide_border: false
          animation: true
          locale: en

      - name: List all files after generation
        run: |
          echo "=== Current directory structure ==="
          find . -name "*.svg" -type f | head -20
          echo ""
          echo "=== Assets/images directory ==="
          ls -la assets/images/ || echo "assets/images directory not found"

      - name: Verify file was generated
        run: |
          if [ ! -f "assets/images/leetcode-stats.svg" ]; then
            echo "⚠️ Warning: leetcode-stats.svg was not generated"
            echo "This might be because:"
            echo "1. LeetCode username 'xlreon' doesn't exist or has no stats"
            echo "2. The action needs different configuration"
            echo "3. LeetCode API is unavailable"
            echo "4. The action generates files in a different location"
          else
            echo "✅ leetcode-stats.svg generated successfully"
          fi

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add assets/images/leetcode-stats.svg 2>/dev/null || true
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "Update LeetCode stats"
            git push
          else
            echo "No changes to commit - file may not have been generated"
            echo "This is expected if the LeetCode username doesn't exist or has no stats"
            exit 1
          fi
